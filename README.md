# Simple Shell

C언어로 구현한 간단한 유닉스 셸입니다.

이 프로젝트는 셸의 기본적인 기능인 명령어 실행, 내장 명령어 처리, 파이프라인, 명령어 히스토리 공유 기능을 구현하여 운영체제의 프로세스 관리와 IPC(Inter-Process Communication)에 대한 이해를 돕는 것을 목표로 합니다.

## 주제 설명

### 시스템 설계도

이 셸의 전체적인 실행 흐름은 다음과 같습니다.

```
+-------------------+      +------------------+      +-----------------+      +----------------------+
|   sh_loop()       |----->|  sh_read_line()  |----->| sh_split_line() |----->|     sh_execute()     |
| (in main.c)       |      |  (in read.c)     |      |  (in split.c)   |      |    (in main.c)       |
+-------------------+      +------------------+      +-----------------+      +----------+-----------+
        ^                                                                                 |
        |                                                                                 |
        +---------------------------------------------------------------------------------+
                                                                                          |
                                 +--------------------------------------------------------+
                                 |
                 +---------------v----------------+
                 |   Is it a pipe command?        |
                 | (find_pipe_index in pipe.c)    |
                 +---------------+----------------+
                                 |
                 +-------(No)-----+-----(Yes)------+
                 |                                 |
+----------------v----------------+   +------------v-------------+
| Is it a built-in command?       |   |   pipe_execute()         |
| (get_builtin_cmd in builtin.c)  |   |   (in pipe.c)            |
+----------------+----------------+   +------------+-------------+
                 |                                 |
 +-------(Yes)---+-----(No)--------+   +-----------v--------------+
 |                                 |   | Fork two child processes |
 |                                 |   | and connect with a pipe  |
+v---------------------+ +---------v----------+ +--------------------------+
| Run built-in function| |   sh_launch()      | | execute_process() is     |
| (e.g., cd, history)  | |   (in launch.c)    | | called in each child     |
+----------------------+ +---------+----------+ +--------------------------+
                                   |
                       +-----------v----------+
                       | Fork a child process |
                       | and execvp()         |
                       +----------------------+
```

1.  **초기화**: 셸이 시작될 때 `init_history()`를 호출하여 **공유 메모리**와 **세마포어**를 초기화합니다. 이를 통해 여러 셸 프로세스가 명령어 히스토리를 공유할 수 있는 기반을 마련합니다.
2.  **메인 루프 (`sh_loop`)**: 사용자에게 프롬프트를 보여주고 입력을 기다립니다.
3.  **입력 읽기 (`sh_read_line`)**: 사용자가 입력한 한 줄의 명령어를 읽습니다.
4.  **토큰 분리 (`sh_split_line`)**: 읽어들인 명령어를 공백 기준으로 토큰(인자 배열)으로 분리합니다.
5.  **명령어 실행 (`sh_execute`)**:
    *   실행된 명령어는 `add_history()`를 통해 공유 메모리에 저장됩니다.
    *   명령어에 파이프(`|`)가 있는지 확인합니다.
    *   **파이프가 없을 경우**:
        *   명령어가 `cd`, `help`, `exit`, `history` 같은 **내장 명령어**인지 확인하고, 맞다면 해당 함수를 직접 실행합니다.
        *   내장 명령어가 아니라면 `sh_launch`를 통해 **외부 프로그램**을 실행합니다. `fork()`로 자식 프로세스를 생성하고 `execvp()`로 프로그램을 로드하여 실행합니다.
    *   **파이프가 있을 경우**:
        *   `pipe_execute` 함수를 호출하여 두 개의 자식 프로세스를 파이프로 연결하여 실행합니다.

### 사용된 기술

*   **프로세스 간 통신 (IPC)**:
    *   **공유 메모리 (`shm_open`, `mmap`)**: 여러 셸 프로세스가 명령어 히스토리를 공유하기 위해 사용됩니다. 공유 메모리 객체를 생성하고 각 프로세스의 주소 공간에 매핑하여 데이터를 공유합니다.
    *   **세마포어 (`sem_open`)**: 공유 메모리에 저장된 히스토리에 여러 프로세스가 동시에 접근하여 발생할 수 있는 경쟁 상태(Race Condition)를 방지하기 위해 사용됩니다.
    *   **파이프 (`pipe`, `dup2`)**: 파이프라인(`|`) 기능을 구현하기 위해 사용됩니다.
*   **프로세스 관리**: `fork()`, `execvp()`, `waitpid()`
    *   새로운 프로세스를 생성하고, 지정된 프로그램을 실행하며, 프로세스의 종료를 동기화하는 셸의 핵심 기능을 구현합니다.
*   **내장 명령어 처리**: 함수 포인터
    *   `cd`, `help`, `history` 등 셸에 내장된 기능을 효율적으로 관리하고 호출하기 위해 함수 포인터 배열을 사용합니다.
*   **동적 메모리 관리**: `malloc()`, `realloc()`
    *   사용자 입력의 길이나 인자의 개수가 정해져 있지 않으므로, 동적으로 메모리를 할당하여 효율적으로 사용합니다.

### 사용 매뉴얼

1.  **빌드 및 실행**: 프로젝트를 빌드하고 생성된 실행 파일을 실행합니다.
    ```bash
    ./simple-shell
    ```

2.  **기본 명령어**: 시스템에 설치된 대부분의 프로그램 실행이 가능합니다.
    ```sh
    > ls -l
    > cat filename.txt
    ```

3.  **내장 명령어**:
    *   `cd [directory]`: 작업 디렉터리를 변경합니다.
    *   `help`: 셸에 대한 간단한 도움말과 내장 명령어 목록을 보여줍니다.
    *   `exit`: 셸을 종료합니다.
~~~~~~~~    *   `history`: 이전에 입력했던 명령어 목록을 보여줍니다. 이 목록은 다른 터미널에서 실행된 셸과도 공유됩니다.

4.  **파이프라인 (`|`)**: 하나의 명령어의 출력을 다른 명령어의 입력으로 연결할 수 있습니다.
    ```sh
    # 현재 디렉터리의 파일 목록이 화면에 출력되고,
    # 동시에 wc -l 명령어가 파일 개수를 세어 마지막에 출력합니다.
    > ls | wc -l
    ```
